<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>File Read Write</title>

    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile.structure-1.3.2.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile.theme-1.3.2.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.3.2.css" />

    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery.mobile-1.3.2.js"></script>

</head>
<body>
    <div data-role="header">
        <a data-rel="back" style="margin-top: 8px;">Home</a>
        <div style="text-align: center;">
            <h2>File Read Write</h2>
        </div>
    </div>
    <img id="imgProfile" />

    <script type="text/javascript">

        capturePhoto();

        function capturePhoto() {
            sessionStorage.removeItem('imagepath');
            // Take picture using device camera and retrieve image as base64-encoded string
            navigator.camera.getPicture(onPhotoDataSuccess, onFail, { quality: 50, destinationType: destinationType.FILE_URI });
        }

        function onPhotoDataSuccess(imageURI) {
            // Uncomment to view the base64 encoded image data
            // console.log(imageData);

            // Get image handle
            //
            var imgProfile = document.getElementById('imgProfile');

            // Show the captured photo
            // The inline CSS rules are used to resize the image
            //
            imgProfile.src = imageURI;

            // Resolve file path, then Move the file
            window.resolveLocalFileSystemURI(imageURI, resolveOnSuccess, resOnError);
        }


        //Callback function when the file system uri has been resolved
        function resolveOnSuccess(entry) {
            var d = new Date();
            var n = d.getTime();
            //new file name
            var newFileName = n + ".jpg";
            var myFolderApp = "MyAppFolder";

            window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function (fileSys) {
                //The folder is created if doesn't exist
                fileSys.root.getDirectory(myFolderApp,
                { create: true, exclusive: false },
                function (directory) {
                    entry.moveTo(directory, newFileName, successMove, resOnError);
                },
                resOnError);
            },
            resOnError);
        }

        //Callback function when the file has been moved successfully - inserting the complete path
        function successMove(entry) {
            //Store imagepath in session for future use
            // like to store it in database
            sessionStorage.setItem('imagepath', entry.fullPath);
            alert(entry.fullPath);
        }

        // Called if something bad happens.
        // 
        function onFail(message) {
            alert('Failed because: ' + message);
        }

        function resOnError(error) {
            alert(error.code);
        }
    </script>
</body>
</html>
